{% extends "base.html" %}
{% block content %}

<div class="container-clientes">
  <h1 class="titulo-seccion">Clientes</h1>

  <!-- FORMULARIO -->
  <div class="formulario-box">
    <h2 class="formulario-titulo">
      {{ 'Editar Cliente' if editar else 'Nuevo Cliente' }}
    </h2>
    <form method="post" action="{{ url_for('clientes_routes.editar_cliente', id=cliente_editar.id) if editar else url_for('clientes_routes.nuevo_cliente') }}">
      <div class="formulario-grid">
        <input type="text" name="nombre" placeholder="Nombre" required value="{{ cliente_editar.nombre if editar else '' }}" class="input-field" />
        <input type="text" name="apellido" placeholder="Apellido" required value="{{ cliente_editar.apellido if editar else '' }}" class="input-field" />
        <input type="text" name="telefono" placeholder="TelÃ©fono" value="{{ cliente_editar.telefono if editar else '' }}" class="input-field" />
        <input type="email" name="email" placeholder="Email" value="{{ cliente_editar.email if editar else '' }}" class="input-field" />
        <input type="text" name="direccion" placeholder="DirecciÃ³n" value="{{ cliente_editar.direccion if editar else '' }}" class="input-field md:col-span-2" />
      </div>
      <div class="formulario-acciones">
        <button type="submit" class="btn-primario">
          {{ 'ðŸ’¾ Guardar Cambios' if editar else 'âž• Agregar Cliente' }}
        </button>
        {% if editar %}
        <a href="{{ url_for('clientes_routes.clientes') }}" class="link-cancelar">Cancelar</a>
        {% endif %}
      </div>
    </form>
  </div>

  <!-- BUSCADOR -->
  <div class="buscador">
    <input type="text" id="buscar" placeholder="Buscar cliente por nombre, apellido o telÃ©fonoâ€¦" class="input-field" oninput="filtrarClientes()" />
  </div>

  <!-- TABLA -->
  <div class="tabla-container">
    <table class="tabla-clientes">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>TelÃ©fono</th>
          <th>Email</th>
          <th>DirecciÃ³n</th>
          <th>Compras</th>
          <th>Deuda</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tabla-clientes">
        {% for data in clientes_data %}
        <tr>
          <td>{{ data.cliente.nombre }}</td>
          <td>{{ data.cliente.apellido }}</td>
          <td>{{ data.cliente.telefono }}</td>
          <td>{{ data.cliente.email }}</td>
          <td>{{ data.cliente.direccion }}</td>
          <td>${{ '%.2f' | format(data.compras) }}</td>
          <td>${{ '%.2f' | format(data.deuda) }}</td>
          <td class="acciones">
            <a href="{{ url_for('clientes_routes.editar_cliente', id=data.cliente.id) }}" class="link-editar">Editar</a>
            <form method="post" action="{{ url_for('clientes_routes.eliminar_cliente', id=data.cliente.id) }}">
              <button type="submit" onclick="return confirm('Â¿Eliminar cliente?')" class="link-eliminar">Eliminar</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- MODAL ERROR -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div id="modalError" class="modal-error">
      <div class="modal-contenido">
        <div class="text-center">
          <h2 class="modal-titulo">âš  Error</h2>
          <p class="modal-mensaje">{{ messages[0] }}</p>
          <button onclick="document.getElementById('modalError').remove()" class="btn-modal">Cerrar</button>
        </div>
      </div>
    </div>
  {% endif %}
{% endwith %}

<script>
function filtrarClientes() {
  const filtro = document.getElementById('buscar').value.toLowerCase();
  const filas = document.querySelectorAll('#tabla-clientes tr');
  filas.forEach(fila => {
    const texto = fila.innerText.toLowerCase();
    fila.style.display = texto.includes(filtro) ? '' : 'none';
  });
}
</script>

{% endblock %}
